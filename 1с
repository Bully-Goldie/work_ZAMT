19
&НаСераере
• Процедура ОткрытьФайлНаСервере ()
ДокументОбъекр-реквизитформыЗначение ("Объект") :
Данныефайла-Новый ДвоичныеДанные (ПутьФайлу) ;
КоличествоСтрок-Документобъект. Документация. Количество () :
Документобьект. Документация. Добавить ():
Документобъект. Документация (КоличествоСтрок) Файл-Новый Хранилицезначения (Данныефайла, Новый сжатиеданных (9)) :
ДокументОбъект .Документация (КоличествоСтрок] . Имяфайла=ИмяфайлаДиалоп;
Документобъект. Документация (Количествострок). Расширениефайла=РасширениефайлаИзДиалога;
ДокументОбъект. Записать () :
ЗначениевРеквизитформы (ДокументОбъект, "Объект") ;
Конецпроцедуры
&НаКлиенте
процедура Открытьфайл (Команда)
?! Вызов диалога выбора файла
Диалог=
Новый Диалогвыборафайла (РежимдиалогаВыборафайла. Открытие) :
Диалог. Множественныйвыбор-Ложь ;
Если Диалог. Выбрать () Тогда
//Определение имени файла и расширения файла из пути файла
ПозицияПоследнейточки-Стрнайти (ПутькФайлу, ". ", НаправлениеПоиска. СКонца, , 1) ;
ПозицияПо следнегослоша-Стрнайти (Путькфайлу, "\ ", НаправлениеПоиска. СКонца, , 1) :
РасширениефайлазДиалога-Прав (ПутьФайлу, Стрдлина (ПутьКфайлу) -ПозицияПоследнейточки) :
имяФайлаЙДиалод=Сред (Путь кфайлу, ПозицияПоследнегослеша+1, ПозицияПоследнейточки-ПозицияПоследнерослеша-1) ;
Конецесли:
Если НЕ Путькфайлу="" Торда
ОткрытьфайлНаСерзере () ;
Элементы. Документациязатрузитьфайл. Доступность-Истина;
Иначе
Сообщить ("файл не выбран !");
КонецЕсли;
Конецпроцедуры
& НаКлиенте
• Процедура Приоткрытии (Отказ)
Если
Объект. Документация. Количество () >0 тоща
Элементы. ДокументацияЗагрузитьфайл. Доступность-Истина:
Иначе
КонецЕсли;
Конецпроцедуры
Элементы. ДокументацияЗагрузитьфайл. Доступность=Ложь;
«наСервере
• Процедура ЗагрузитьФайНаСервере (НомерСтроки)
Документобъект=РеквизитформыВЗначение ("объект") ;
Путь=ПолучитьимВременногофайла (ДокументОбъект. Документация (НомерСтроки-1]. Расширениефайла) ;
Данные-ДокументОбъект. Документация [НомерСтроки-1]. файл. Получить () :
Данные. Записать (Путь) ;
ЗапуститьПриложение (Путь) ;
Значениевреквизитформы (ДокументОбъект, "Объект") ;
КонецПроцедуры
& НаКлиенте
• Процедура Загрузить файл (Команда)
НомерТекущейСтроки=Элементы. Документация. ТекущиеДанные. НомерСтроки;
ЗагрузитьФайлНаСервере (НомертекущейСтроки) ;
Конецпроцедуры